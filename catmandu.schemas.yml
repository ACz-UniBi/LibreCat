_prefix:
  schemas:

#used in LibreCat::Validator::Award
award:
  "$schema": "http://json-schema.org/draft-04/schema#"
  title: "librecat award"
  type: "object"
  properties:
    _id:
      type: string
      description: "Award identifier"
      pattern: "^AW[0-9]+$"
      minLength: 1
    _version:
      oneOf:
        - type: string
          minLength: 1
        - type: integer
      description: "Award version"
    sort_id:
      type: string
      description: "Sortable identifier"
    oldid:
      type: string
      minLength: 1
      description: "Old identifier"
    award_id:
      type: string
      pattern: "^AW[0-9]+$"
      description: "Award identifier"
    rec_type:
      type: string
      enum: [preis,auszeichnung,akademie,record]
      description: "Record type"
    date_created: &dt
      type: string
      format: date-time
      description: "Record creation time"
    date_updated: *dt
    title:
      type: string
      minLength: 1
      description: "Award title"
    title_en:
      type: string
      description: "Award title in English"
    norm_title:
      type: string
      description: "Normalized title"
    description:
      type: string
      description: "Description"
    description_en:
      type: string
      description: "Description in English"
    url:
      type: string
      format: uri
      description: "URL"
    proof:
      type: string
      description: "???"
    year:
      type: string
      pattern: "^[0-9]{4}$"
      description: "Year of award"
    comment:
      type: string
      description: "Comment"
    department:
      type: array
      items:
        additionalProperties: false
        required: [_id]
        properties:
          _id:
            oneOf:
              - type: string
                pattern: "^[0-9]+$"
                minLength: 1
              - type: integer
                minimum: 0
            description: "Department name"
          name:
            type: string
            description: "Department identifier"
      description: "Department"
    einrichtung:
      type: array
      items:
        additionalProperties: false
        properties:
          name:
            type: string
            minLength: 1
            description: "???"
          _id:
            type: string
            description: "???"
      description: "???"
    other_university:
      type: string
      description: "Name of another university involved in the award"
    uni_member:
      oneOf:
        - type: string
          enum: [0,1]
        - type: integer
          minimum: 0
          maximum: 1
      description: "???"
    former_member:
      type: string
      enum: ["ja","nein","emeritiert","in Rente"]
      description: "Former member"
    extern:
      oneOf:
        - type: string
          enum: [0,1]
        - type: integer
          minimum: 0
          maximum: 1
      description: "???"
    organization:
      type: string
      description: "Organization involved in the award"
    honoree:
      type: array
      items:
        type: object
        required: [first_name,last_name,full_name]
        additionProperties: false
        properties:
          first_name:
            type: string
            minLength: 1
            description: "???"
          last_name:
            type: string
            minLength: 1
            description: "???"
          full_name:
            type: string
            minLength: 1
            description: "???"
          title:
            type: string
            description: "???"
      description: "???"
  required: ["_id","rec_type","title"]
  additionalProperties: false

#used in LibreCat::Validator::Publication
publication:
  "$schema": "http://json-schema.org/draft-04/schema#"
  title: "librecat publication"
  type: "object"
  definitions:
    iso_language: &iso_language
      type: object
      properties:
         iso:
             type: string
             enum: [ara,chi,cze,dan,dut,eng,fin,fre,ger,gre,heb,hrv,hun,ice,ita,jpn,kor,lat,lav,mon,nor,other,pol,por,rum,rus,spa,srp,swe,tur]
             description: "ISO language code"

    abstract: &abstract
      type: object
      properties:
        lang:
          type: string
          enum: [ara,chi,cze,dan,dut,eng,fin,fre,ger,gre,heb,hrv,hun,ice,ita,jpn,kor,lat,lav,mon,nor,other,pol,por,rum,rus,spa,srp,swe,tur]
          description: "Abstract used language"
        text:
          type: string
          minLength: 1
          description: "Abstract content"
      additionalProperties: false

    department: &department
      type: object
      properties:
        #TODO: _id must refer to valid department? Possible in JSON-Schema?
        _id:
          #in perl, its hard to distinguish between integer and string that look like an integer
          oneOf:
            - type: string
              pattern: "^[0-9]+$"
              minLength: 1
            - type: integer
              minimum: 0
          description: "Department identifier"
        tree:
          type: array
          items:
            type: object
            properties:
              _id:
                oneOf:
                  - type: string
                    pattern: "^[0-9]+$"
                    minLength: 1
                  - type: integer
                    minimum: 0
                description: "Parent department"
          description: "Hierarchical structure"

      required: ["_id","tree"]
      additionalProperties: false

    author:
      type: object
      properties:
        first_name: &hn
          type: string
          minLength: 1
          description: "Person first name"
        last_name:
          type: string
          minLength: 1
          description: "Person last name"
        full_name:
          type: string
          minLength: 1
          description: "Person full name"

    file:
        type: object
        properties:
            access_level:
                type: string
                enum:
                   - open_access
                   - local
                   - closed
                   - request
                description: "Access level"
            content_type:
                type: string
                description: "MIME Type"
            creator:
                type: string
                description: "User name"
            date_created:
                type: string
                format: date-time
                description: "Upload date"
            date_updated:
                type: string
                format: date-time
                description: "Last modification date"
            file_id:
                type: integer
                description: "Persistent File Id"
            file_name:
                type: string
                description: "File name"
            file_size:
                type: integer
                description: "File size"
            open_access:
                type: integer
                description: "???"
            relation:
                type: string
                enum:
                    - main_file
                    - confirmation
                    - table_of_contents
                    - erratum
                    - supplementary_material
                    - other
                    - hidden
                description: "Relation upload to main record"
        required: ["access_level","content_type","creator","date_created","date_updated","file_id","open_access","relation"]

    project: &project
      type: object
      properties:
        _id:
          type: string
          pattern: "^P[0-9]+$"
          minLength: 1
          description: "Project identifier"
        name:
          type: string
          description: "Project name"
      required: ["_id"]

    research_group: &research_group
      type: object
      properties:
        _id:
          type: string
          pattern: "^RG[0-9]+$"
          minLength: 1
          description: "Research group identifier"
        name:
          type: string
          description: "Research group name"
      required: ["_id"]

  properties:
    _id:
      oneOf:
        - type: string
          pattern: "^[0-9]+$"
          minLength: 1
        - type: integer
          minimum: 0
      description: "Publication identifier"
    type:
      type: string
      enum:
        - original
        - book
        - book_editor
        - book_chapter
        - review
        - conference_abstract
        - conference_editor
        - conference
        - dissertation
        - encyclopedia_article
        - journal_article
        - journal_editor
        - newspaper_article
        - patent
        - preprint
        - report
        - translation
        - translation_chapter
        - working_paper
        - bi_dissertation
        - research_data
      description: "Publication type"
    creator:
      type: object
      properties:
        login:
          type: string
          description: "Creator user name"
      description: "Creator"
    date_created:
      type: string
      format: date-time
      description: "Record creation date"
    date_submitted:
      type: string
      format: date-time
      description: "?not in use?"
    date_updated:
      type: string
      format: date-time
      description: "Record last update date"
    document_type:
      type: string
      enum:
        - bi_dissertation
        - book
        - book_chapter
        - book_editor
        - conference
        - conference_abstract
        - conference_editor
        - dissertation
        - encyclopedia_article
        - journal_article
        - journal_editor
        - newspaper_article
        - patent
        - preprint
        - report
        - research_data
        - review
        - translation
        - translation_chapter
        - working_paper
    doi:
      type: string
      #stolen from http://www.regexpal.com/93795
      pattern: ^10[.][0-9]{4,}(?:[.][0-9]+)*/(?:(?!["&'<>])\S)+$
      description: "DOI"
    author:
      type: array
      minItems: 0
      uniqueItems: true
      items:
        '$ref': '#/definitions/author'
      description: "Author"
    editor:
      type: array
      minItems: 0
      uniqueItems: true
      items:
        '$ref': '#/definitions/author'
      description: "Editor"
    translator:
      type: array
      minItems: 0
      uniqueItems: true
      items:
        '$ref': '#/definitions/author'
      description: "Translator"
    supervisor:
      type: array
      minItems: 0
      uniqueItems: true
      items:
        '$ref': '#/definitions/author'
      description: "Supervisor"
    corporate_editor:
      type: array
      items:
        type: string
      description: "Corporate editors"
    title:
      type: string
      minLength: 1
      description: "Publication title"
    alternative_title:
      type: array
      items:
        type: string
      description: "Alternative title"
    #required when type = 'journalArticle'
    publication:
      type: string
      description: "Title of host publication"
    publication_identifier:
      type: object
      properties:
        issn:
          type: array
          items:
            type : string
          description: "ISSN number"
        isbn:
          type: array
          items:
            type : string
          description: "ISBN number"
        eissn:
          type: array
          items:
            type : string
          description: "electonic ISSN number"
        eisbn:
          type: array
          items:
            type : string
          description: "electronic ISBN number"
      description: "Publication identifier"
    publication_status:
      type: string
      enum: [draft,submitted,accepted,inpress,epub_ahead,published]
      description: "Publication status"
    pubmedID:
      oneOf:
        - type: string
          pattern: '^[0-9]+$'
        - type: integer
          minimum: 0
      description: "PubMed identifier"
    quality_controlled:
      oneOf:
        - type: boolean
        - type: integer
          minimum: 0
          maximum: 1
        - type: string
          enum: ["0","1"]
      description: "Flag of quality control"
    status:
      type: string
      enum: [new,submitted,public,returned,private]
      description: "Record status"
    department:
      type: array
      items:
        '$ref': '#/definitions/department'
      description: "Department"
    project:
      type: array
      minItems: 0
      items:
        '$ref': '#/definitions/project'
      description: "Related projects"
    research_group:
      type: array
      minItems: 0
      items:
        '$ref': '#/definitions/research_group'
      description: "Research group"
    year:
      oneOf:
        - type: string
          pattern: "^[0-9]+$"
          minLength: 1
        - type: integer
          minimum: 0
      description: "Publication year"
    abstract:
      type: array
      items:
        '$ref': '#/definitions/abstract'
      description: "Abstract"
    language:
      type: array
      items:
        '$ref': '#/definitions/iso_language'
      description: "Language of publication"
    publisher:
      type: string
      description: "Publisher"
    place:
      type: string
      description: "Place of publication"
    volume:
      type: string
      description: "Volume"
    intvolume:
      type: string
      description: "???"
    issue:
      type: string
      description: "Issue number"
    page:
      type: string
      pattern: '^[0-9]+(-[0-9]+)?$'
      description: "Page number"
    external_id:
      type: object
      description: "External identifier"
      properties:
        unknown:
          type: string
          description: "Unknown source identifier"
        isi:
          type: string
          description: "Web of Science identifier"
        pmid:
          type: string
          description: "PubMed identifier"
        inspire:
          type: string
          description: "Inspire identifier"
        arxiv:
          type: string
          description: "Arxiv identifier"
        ahf:
          type: string
          description: "???"
        opac:
          type: string
          description: "Opac identifier"
        scoap3:
          type: string
          description: "???"
    file:
      type: array
      minItems: 0
      items:
        '$ref': '#/definitions/file'
      description: "File uploads"
    citation:
      type: object
      properties:
        ama:
          type: string
          description: "Citation in AMA (American Medical Association) style"
        apa:
          type: string
          description: "Citation in APA (American Psychological Association) style"
        apa_indent:
          type: string
          description: "Citation in indented APA style"
        aps:
          type: string
          description: "Citation in APA (American Psychological Society) style"
        bio1:
          type: string
          description: "???"
        default:
          type: string
          description: "???"
        dgps:
          type: string
          description: "Citation in DGPS (Deutsche Gesellschaft fur Psychologie) style"
        ewi:
          type: string
          description: "???"
        frontShortTitle:
          type: string
          description: "???"
        frontiers:
          type: string
          description: "Citation in Frontiers journals style"
        harvard1:
          type: string
          description: "Citation in 'Harvard Reference format 1' style"
        ieee:
          type: string
          description: "Citation in IEEE (Institute of Electrical and Electronics Engineers) style"
        lncs:
          type: string
          description: "???"
        mla:
          type: string
          description: "Citation in MLA (Modern Language Association) style"
        pub:
          type: string
          description: "???"
        sfb882:
          type: string
          description: "???"
        wels:
          type: string
          description: "???"
      description: "Citation"

  # A author|editor is required..can this be expressed in JSONSchema?
  required: ["_id","type","title","year"]
  additionalProperties: true

#used in LibreCat::Validator::Researcher
researcher:
  "$schema": "http://json-schema.org/draft-04/schema#"
  title: "librecat researcher"
  type: "object"
  definitions:
    department: *department

  properties:
    _id:
      #in perl, its hard to distinguish between integer and string that look like an integer
      oneOf:
        - type: string
          pattern: "^[0-9]+$"
          minLength: 1
        - type: integer
          minimum: 0
      description: "Researcher identifier"
    account_status:
      type: string
      enum: ["active","inactive"]
      description: "Account status"
    account_type:
      type: string
      minLength: 1
      pattern: '^\S+$'
      description: "Account type"
    password:
      type: string
      minLength: 1
      pattern: '^\S+$'
      description: "Password"
    login:
      type: string
      minLength: 1
      pattern: '^\S+$'
      description: "Login name"
    email:
      type: string
      format: email
      description: "Email address"
    first_name:
      type: string
      minLength: 0
      description: "First name"
    last_name:
      type: string
      minLength: 0
      description: "Last name"
    full_name:
      type: string
      minLength: 0
      description: "Full name"
    department:
      type: array
      items:
        type: object
        properties:
          _id:
            oneOf:
              - type: string
                pattern: "^[0-9]+$"
                minLength: 1
              - type: integer
                minimum: 0
            description: "Department identifier"
      description: "Department"

  required: ["_id","account_status","account_type","first_name","last_name","full_name"]
  additionalProperties: true

department:
  type: object
  properties:
    #TODO: _id must refer to valid department? Possible in JSON-Schema?
    _id:
      #in perl, its hard to distinguish between integer and string that look like an integer
      oneOf:
        - type: string
          pattern: "^[0-9]+$"
          minLength: 1
        - type: integer
          minimum: 0
      description: "Department identifier"
    display:
      type: string
      description: "Displayed name"
    layer:
      type: integer
      description: "???"
    name:
      type: string
      description: "Department name"
    tree:
      type: array
      items:
        type: object
        properties:
          _id:
            oneOf:
              - type: string
                pattern: "^[0-9]+$"
                minLength: 1
              - type: integer
                minimum: 0
            description: "Parent department"
      description: "Hierarchical structure"

  required: ["_id","tree"]
  additionalProperties: false

project:
  "$schema": "http://json-schema.org/draft-04/schema#"
  title: "librecat project"
  type: "object"
  properties:
    _id:
      type: string
      pattern: "^P[0-9]+$"
      description: "Project identifier"
    name:
      type: string
      minLength: 1
      description: "Project name"
    acronym:
      type: string
      description: "Project acronym"
    alternative_name:
      type: string
      description: "Project's alternative name"
    url:
      type: string
      format: uri
      description: "Project's URL"
    grant_number:
      type: string
      description: "Grant number"
    psp_element:
      type: string
      description: "???"
    description:
      type: string
      description: "Description of the project"
    start_date:
      type: string
      format: date
      description: "Starting date"
    end_date:
      type: string
      format: date
      description: "Ending date"
    date_created:
      type: string
      format: date-time
      description: "The record creation date"
    date_updated:
      type: string
      format: date-time
      description: "The record's last modification date"
    affiliation:
      type: string
      description: "Project's affiliation"
    owner:
      type: array
      items:
        type: object
        properties:
          first_name:
            type: string
            minLength: 1
            description: "Project's owners first name"
          last_name:
            type: string
            minLength: 1
            description: "Project's owners last name"
      description: "Project's owners"
    designated_editor:
      type: array
      items:
        type: object
        properties:
          first_name:
            type: string
            minLength: 1
            description: "Designated editor first name"
          last_name:
            type: string
            minLength: 1
            description: "Designated editor last name"
      description: "Designated editor"
    principal_investigator:
      type: array
      items:
        type: object
        properties:
          first_name:
            type: string
            minLength: 1
            description: "Principal investigators first name"
          last_name:
            type: string
            minLength: 1
            description: "Principal investigators last name"
      description: "Principal investigators"
    uni_member:
      type: array
      items:
        type: object
        properties:
          first_name:
            type: string
            minLength: 1
            description: "Participating university members first name"
          last_name:
            type: string
            minLength: 1
            description: "Participating university members last name"
      description: "Participating university members"
    cooperator:
      type: array
      items:
        type: string
        minLength: 1
      description: "Cooperating partner"
    funder:
      type: array
      items:
        type: string
        minLength: 1
      description: "Funding agency"
    call_identifier:
      type: string
      description: "Identifier of the call"
    funded:
      oneOf:
        - type: boolean
        - type: integer
          minimum: 0
          maximum: 1
        - type: string
          enum: ["0","1"]
      description: "Flag of funding status"

  required: ["_id","name"]
  additionalProperties: true

research_group:
  "$schema": "http://json-schema.org/draft-04/schema#"
  title: "librecat research group"
  type: "object"
  properties:
    _id:
      type: string
      pattern: "^RG[0-9]+$"
      description: "Research group identifier"
    name:
      type: string
      minLength: 1
      description: "Name of research group"
    acronym:
      type: string
      minLength: 1
      description: "Acronym"
    start_date:
      type: string
      format: date
      description: "The research group's starting date"
    end_date:
      type: string
      format: date
      description: "The research group's ending date"
    date_created:
      type: string
      format: date-time
      description: "The research group's ending date"
    date_updated:
      type: string
      format: date-time
      description: "The record's last modification date"
    affiliation:
      type: string
      description: "Affiliation of the research group"
    department:
      type: array
      items:
        type: object
        properties:
          _id:
            oneOf:
              - type: string
                pattern: "^[0-9]+$"
                minLength: 1
              - type: integer
                minimum: 0
            description: "The department identifier"
      description: "Departments involved"

  required: ["_id","name"]
  additionalProperties: true
